---
layout: post
title:  "Windows Kernel Debugging"
date:   2017-06-13
excerpt: "Windows Kernel Debugging"
tag:
- Windows
- Kernel
- Debugging
---

# Windows Kernel Debugging

## Required

- Windows 7 이상
- VMWare 10 이상 *(Recommended)*
- Windbg

## Settings

1. VMWare에 커널 디버깅을 수행 할 Windows를 설치한다.
2. 설치 후 VMWare에서 Windows를 선택하여 Virtual Machine Settings에 들어간 후 Add버튼을 클릭한다.
3. Add를 누르면 Add Hardware Wizard창이 나오는데 Serial Port를 선택 후 Next버튼을 클릭한다.
4. Next를 누르면 Serial Port Type을 설정하는 단계이며, Output to named pipe를 선택한 후 Next버튼을 클릭한다.
5. 다음 단계로 넘어가면 Specify Socket 설정 단계이다. 여기서는 Named pipe에 빈칸에 아 래와 같이 \\\\.\\pipe\\com_1을 적은 후 Finish를 클릭한다.
6. 이제 VMWare를 통해 Windows를 부팅한 후 명령프롬프트(cmd)를 administrator권한으로 실 행시킨 후 아래와 같은 명령어를 수행한다.
> bcdedit /debug on<br>
bcdedit /dbgsettings serial debugport:2 baudrate:115200<br>
VMWare에서 Serial Port설정 시 추가된 포트 번호에 따라 변경해주면된다.<br>
여기서는 Serial Port 2이므로 debugport의 값에 2를 넣었다.
7. 이제 Windows의 설정은 끝이났고, VMWare가 설치되어 있는 컴퓨터에 [Windbg][1]를 설치한다.
8. 설치가 완료되면 Windbg를 VMware에 설치된 커널 디버깅을 위한 윈도우에 맞게 x86또는
x64를 선택하여 실행한다.
9. Windbg를 실행하여 [File]->[Symbol File Path] 메뉴에 들어가 다음 값을 넣고 OK버튼을 누른 다.
> SRV\*c:\symbols\*http://msdl.microsoft.com/download/symbols
10. [File]->[Kernel Debug] 메뉴에 접근하면 Kernel Debugging창이 뜨는데 탭 중에서 COM을 클 릭한 후 Port에 VMWare에서 Serial Port의 pipe name으로 설정했던 \\\\.\\pipe\\com_1을 넣고 Pipe를 체크한 후 확인을 누른다.
11. 확인을 누르면 아래와 같이 Wating to reconnet...상태가 될텐데 VMWare에서 커널 디버깅 할 Windows를 재부팅한다.
12. Windows를 재부팅하게 되면 Windbg를 통해 커널 디버깅 모드에 들어간다.
13. 이제 커널 디버깅을 즐기면 된다.

[1]: https://developer.microsoft.com/ko-kr/windows/hardware/windows-driver-kit
